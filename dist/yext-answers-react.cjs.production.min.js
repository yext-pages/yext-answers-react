"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,r=e(require("cross-fetch")),n=require("react"),i=e(n),o=require("use-query-params"),a=e(require("recent-searches")),s=function(){function e(e,t,r){this.searchService=e,this.questionSubmissionService=t,this.autoCompleteService=r}return e.prototype.universalSearch=function(e){return this.searchService.universalSearch(e)},e.prototype.verticalSearch=function(e){return this.searchService.verticalSearch(e)},e.prototype.submitQuestion=function(e){return this.questionSubmissionService.submitQuestion(e)},e.prototype.universalAutocomplete=function(e){return this.autoCompleteService.universalAutocomplete(e)},e.prototype.verticalAutocomplete=function(e){return this.autoCompleteService.verticalAutocomplete(e)},e.prototype.filterSearch=function(e){return this.autoCompleteService.filterSearch(e)},e}();function c(e){var t=Object.keys(e)[0],r=Object.keys(e[t])[0];return{fieldId:t,matcher:r,value:e[t][r]}}function u(e){return{latitude:e.latitude,longitude:e.longitude,displayName:e.locationDisplayName,method:e.accuracy}}function l(e){return{originalQuery:e.originalQuery,correctedQuery:e.correctedQuery.value,type:e.type}}!function(e){e.KnowledgeManager="KNOWLEDGE_MANAGER",e.Google="GOOGLE_CSE",e.Bing="BING_CSE",e.Zendesk="ZENDESK",e.Algolia="ALGOLIA",e.Generic="GENERIC"}(t||(t={}));var p,f,d=function(){function e(){}return e.create=function(e,r){var n=this;return e?e.map((function(e,i){var o=i+1;switch(r){case t.KnowledgeManager:return n.fromKnowledgeManager(e,o);case t.Google:return n.fromGoogleCustomSearchEngine(e,o);case t.Bing:return n.fromBingCustomSearchEngine(e,o);case t.Zendesk:return n.fromZendeskSearchEngine(e,o);case t.Algolia:return n.fromAlgoliaSearchEngine(e,o);default:return n.fromGeneric(e,o)}})):[]},e.fromKnowledgeManager=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.KnowledgeManager,index:r,name:i.name,description:i.description,link:i.website,id:i.id,distance:e.distance,distanceFromFilter:e.distanceFromFilter,highlightedFields:e.highlightedFields,entityType:i.type}},e.fromGoogleCustomSearchEngine=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.Google,index:r,name:i.htmlTitle.replace(/(<([^>]+)>)/gi,""),description:i.htmlSnippet,link:i.link}},e.fromBingCustomSearchEngine=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.Bing,index:r,name:i.name,description:i.snippet,link:i.url}},e.fromZendeskSearchEngine=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.Zendesk,index:r,name:i.title,description:i.snippet,link:i.html_url}},e.fromAlgoliaSearchEngine=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.Algolia,index:r,name:i.name,id:i.objectID}},e.fromGeneric=function(e,r){var n,i=null!==(n=e.data)&&void 0!==n?n:e;return{rawData:i,source:t.Generic,index:r,name:i.name,description:i.description,link:i.website,id:i.id}},e.fromDirectAnswer=function(e){var r,n=null!==(r=e.fieldValues)&&void 0!==r?r:{};return{rawData:n,source:t.KnowledgeManager,name:n.name,description:n.description,link:e.website,id:e.id,entityType:e.type}},e}();function h(e){return{displayKey:e.displayKey,displayValue:e.displayValue,filter:c(e.filter),details:e.details}}function v(e){return console.log("createVerticalResults data: ",e),console.log("createVerticalResults: ",e.appliedQueryFilters),{appliedQueryFilters:e.appliedQueryFilters?e.appliedQueryFilters.map(h):[],queryDurationMillis:e.queryDurationMillis,results:d.create(e.results,e.source),resultsCount:e.resultsCount,source:e.source,verticalKey:e.verticalConfigId}}function y(e){var t,r;if(!e.response)throw new Error("The search data does not contain a response property");return console.log("createVerticalSearchResponse:",e.response),{verticalResults:v(e.response),queryId:e.response.queryId,searchIntents:e.response.searchIntents,facets:(r=e.response.facets,r?r.map((function(e){return{fieldId:e.fieldId,displayName:e.displayName,options:(t=e.options,t.map((function(e){var t=c(e.filter);return{displayName:e.displayName,count:e.count,selected:e.selected,matcher:t.matcher,value:t.value}})))};var t})):[]),spellCheck:e.response.spellCheck&&l(e.response.spellCheck),locationBias:e.response.locationBias&&u(e.response.locationBias),allResultsForVertical:e.response.allResultsForVertical&&y({response:e.response.allResultsForVertical}),alternativeVerticals:e.response.alternativeVerticals&&e.response.alternativeVerticals.modules&&e.response.alternativeVerticals.modules.map(v),uuid:null===(t=e.meta)||void 0===t?void 0:t.uuid}}function m(e){var t=(null==e?void 0:e.type)===f.FeaturedSnippet;if((null==e?void 0:e.type)===f.FieldValue)return{type:f.FieldValue,value:e.answer.value,relatedResult:d.fromDirectAnswer(e.relatedItem.data),verticalKey:e.relatedItem.verticalConfigId,entityName:e.answer.entityName,fieldName:e.answer.fieldName,fieldApiName:e.answer.fieldApiName,fieldType:e.answer.fieldType};if(t)return{type:f.FeaturedSnippet,value:e.answer.value,relatedResult:d.fromDirectAnswer(e.relatedItem.data),verticalKey:e.relatedItem.verticalConfigId,snippet:e.answer.snippet};throw new Error("The Answers API returned an unknown direct answer type")}function g(e){var t,r;return(t={})[e.fieldId]=((r={})[e.matcher]=e.value,r),t}function E(e){return void 0!==e.filters&&void 0!==e.combinator}!function(e){e.Standard="STANDARD",e.Overlay="OVERLAY"}(p||(p={})),function(e){e.FeaturedSnippet="FEATURED_SNIPPET",e.FieldValue="FIELD_VALUE"}(f||(f={}));var S=function(){return(S=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},w=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},T=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},b=function(){function e(e,t,r){var n,i,o,a;this.config=e,this.httpService=t,this.apiResponseValidator=r,this.universalSearchEndpoint=null!==(i=null===(n=e.endpoints)||void 0===n?void 0:n.universalSearch)&&void 0!==i?i:"https://liveapi.yext.com/v2/accounts/me/answers/query",this.verticalSearchEndpoint=null!==(a=null===(o=e.endpoints)||void 0===o?void 0:o.verticalSearch)&&void 0!==a?a:"https://liveapi.yext.com/v2/accounts/me/answers/vertical/query"}return e.prototype.universalSearch=function(e){var t;return w(this,void 0,void 0,(function(){var r,n,i;return T(this,(function(o){switch(o.label){case 0:return this.injectToStringMethods(e),r={input:e.query,experienceKey:this.config.experienceKey,api_key:this.config.apiKey,v:20190101,version:this.config.experienceVersion,location:null===(t=e.location)||void 0===t?void 0:t.toString(),locale:this.config.locale,skipSpellCheck:e.skipSpellCheck,sessionTrackingEnabled:e.sessionTrackingEnabled,queryTrigger:e.queryTrigger,context:JSON.stringify(e.context||void 0),referrerPageUrl:e.referrerPageUrl,source:e.querySource||p.Standard},[4,this.httpService.get(this.universalSearchEndpoint,r)];case 1:return n=o.sent(),(i=this.apiResponseValidator.validate(n))instanceof Error?[2,Promise.reject(i)]:[2,(a=n,s=Array.isArray(a.response.modules)?a.response.modules.map(v):[],console.log("createUniversalSearchResponse:",a.response),{verticalResults:s,queryId:a.response.queryId,directAnswer:a.response.directAnswer&&m(a.response.directAnswer),searchIntents:a.response.searchIntents,spellCheck:a.response.spellCheck&&l(a.response.spellCheck),locationBias:a.response.locationBias&&u(a.response.locationBias),uuid:a.meta.uuid})]}var a,s}))}))},e.prototype.verticalSearch=function(e){var t,r;return w(this,void 0,void 0,(function(){var n,i,o;return T(this,(function(a){switch(a.label){case 0:return this.injectToStringMethods(e),n={experienceKey:this.config.experienceKey,api_key:this.config.apiKey,v:20190101,version:this.config.experienceVersion,locale:this.config.locale,input:e.query,location:null===(t=e.location)||void 0===t?void 0:t.toString(),verticalKey:e.verticalKey,filters:e.staticFilters&&(c=e.staticFilters,E(c)?JSON.stringify(function e(t){for(var r,n=[],i=0,o=t.filters;i<o.length;i++){var a=o[i];E(a)?n.push(e(a)):n.push(g(a))}return 1===n.length?n[0]:((r={})[t.combinator]=n,r)}(c)):JSON.stringify(g(c))),limit:e.limit,offset:e.offset,retrieveFacets:e.retrieveFacets,facetFilters:e.facets&&(s=e.facets,JSON.stringify(s.reduce((function(e,t){var r=t.fieldId,n=function(e,t){return e.map((function(e){return g(S(S({},e),{fieldId:t}))}))}(t.options,r);return e[r]=n,e}),{}))),skipSpellCheck:e.skipSpellCheck,queryTrigger:e.queryTrigger,sessionTrackingEnabled:e.sessionTrackingEnabled,sortBys:JSON.stringify(e.sortBys||[]),context:JSON.stringify(e.context||void 0),referrerPageUrl:e.referrerPageUrl,source:e.querySource||p.Standard,locationRadius:null===(r=e.locationRadius)||void 0===r?void 0:r.toString(),queryId:e.queryId},[4,this.httpService.get(this.verticalSearchEndpoint,n)];case 1:return i=a.sent(),(o=this.apiResponseValidator.validate(i))instanceof Error?[2,Promise.reject(o)]:[2,y(i)]}var s,c}))}))},e.prototype.injectToStringMethods=function(e){e.location&&(e.location.toString=function(){return this.latitude+","+this.longitude})},e}(),A=function(){function e(e,t,r){var n,i;this.config=e,this.httpService=t,this.apiResponseValidator=r,this.endpoint=null!==(i=null===(n=this.config.endpoints)||void 0===n?void 0:n.questionSubmission)&&void 0!==i?i:"https://api.yext.com/v2/accounts/me/createQuestion"}return e.prototype.submitQuestion=function(e){return t=this,n=function(){var t,r;return function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:return[4,this.httpService.post(this.endpoint,{v:20190101,api_key:this.config.apiKey,sessionTrackingEnabled:e.sessionTrackingEnabled},{email:e.email,entityId:e.entityId,name:e.name,questionDescription:e.questionDescription,questionLanguage:this.config.locale,questionText:e.questionText,site:"FIRSTPARTY"},{mode:"cors",headers:{"Content-Type":"application/json"}})];case 1:return t=n.sent(),(r=this.apiResponseValidator.validate(t))instanceof Error?[2,Promise.reject(r)]:[2,{uuid:t.meta.uuid}]}}))},new((r=void 0)||(r=Promise))((function(e,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}s((n=n.apply(t,[])).next())}));var t,r,n},e}();function I(e){return Object.keys(e).forEach((function(t){null==e[t]&&delete e[t]})),e}var O,x=function(){return(x=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e.GET="get",e.POST="post"}(O||(O={}));var _=function(){function e(){}return e.prototype.get=function(e,t,r){var n=x({method:O.GET},r);return this.fetch(e,t,n).then((function(e){return e.json()}))},e.prototype.post=function(e,t,r,n){var i=I(r),o=x({method:O.POST,body:JSON.stringify(i)},n);return this.fetch(e,t,o).then((function(e){return e.json()}))},e.prototype.fetch=function(e,t,n){var i=function(e,t){var r=new URL(e),n=new URLSearchParams(r.search.substring(1)),i=I(t);for(var o in i)n.append(o,i[o].toString());var a=r.origin+r.pathname,s=n.toString();return s&&(a+="?"+s),a}(e,t);return r(i,n)},e}();function P(e){var r=e.relatedItem?d.create([e.relatedItem],t.KnowledgeManager)[0]:e.relatedItem;return{filter:e.filter&&c(e.filter),key:e.key,matchedSubstrings:e.matchedSubstrings||[],value:e.value,relatedItem:r}}function R(e){if(!e.response)throw new Error("The autocomplete data does not contain a response property");if(!Object.keys(e.response).length)throw new Error("The autocomplete response is empty");var t=e.response;return{results:t.results.map(P),queryId:t.queryId,inputIntents:(t.input?t.input.queryIntents:[])||[],uuid:e.meta.uuid}}function k(e){if(!e.response)throw new Error("The autocomplete data does not contain a response property");if(!Object.keys(e.response).length)throw new Error("The autocomplete response is empty");var t=e.response,r=!1,n=[],i=[];return t.sections?(r=!0,n=t.sections.map((function(e){return{label:e.label,results:e.results.map(P)}}))):i=t.results.map(P),{sectioned:r,sections:n,results:i,queryId:t.queryId,inputIntents:(t.input?t.input.queryIntents:[])||[],uuid:e.meta.uuid}}var F,N,C,L,q,D,K,U,j,B=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},G=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},V=function(){function e(e,t,r){var n,i,o,a,s,c;this.config=e,this.httpService=t,this.apiResponseValidator=r,this.universalEndpoint=null!==(i=null===(n=this.config.endpoints)||void 0===n?void 0:n.universalAutocomplete)&&void 0!==i?i:"https://liveapi-cached.yext.com/v2/accounts/me/answers/autocomplete",this.verticalEndpoint=null!==(a=null===(o=this.config.endpoints)||void 0===o?void 0:o.verticalAutocomplete)&&void 0!==a?a:"https://liveapi-cached.yext.com/v2/accounts/me/answers/vertical/autocomplete",this.filterEndpoint=null!==(c=null===(s=this.config.endpoints)||void 0===s?void 0:s.filterSearch)&&void 0!==c?c:"https://liveapi-cached.yext.com/v2/accounts/me/answers/filtersearch"}return e.prototype.universalAutocomplete=function(e){return B(this,void 0,void 0,(function(){var t,r;return G(this,(function(n){switch(n.label){case 0:return[4,this.httpService.get(this.universalEndpoint,{input:e.input,experienceKey:this.config.experienceKey,api_key:this.config.apiKey,v:20190101,version:this.config.experienceVersion,locale:this.config.locale,sessionTrackingEnabled:e.sessionTrackingEnabled})];case 1:return t=n.sent(),(r=this.apiResponseValidator.validate(t))instanceof Error?[2,Promise.reject(r)]:[2,R(t)]}}))}))},e.prototype.verticalAutocomplete=function(e){return B(this,void 0,void 0,(function(){var t,r;return G(this,(function(n){switch(n.label){case 0:return[4,this.httpService.get(this.verticalEndpoint,{input:e.input,experienceKey:this.config.experienceKey,api_key:this.config.apiKey,v:20190101,version:this.config.experienceVersion,locale:this.config.locale,verticalKey:e.verticalKey,sessionTrackingEnabled:e.sessionTrackingEnabled})];case 1:return t=n.sent(),(r=this.apiResponseValidator.validate(t))instanceof Error?[2,Promise.reject(r)]:[2,R(t)]}}))}))},e.prototype.filterSearch=function(e){return B(this,void 0,void 0,(function(){var t,r,n,i;return G(this,(function(o){switch(o.label){case 0:return t={sectioned:e.sectioned,fields:this.serializeSearchParameterFields(e.fields)},r={input:e.input,experienceKey:this.config.experienceKey,api_key:this.config.apiKey,v:20190101,version:this.config.experienceVersion,locale:this.config.locale,search_parameters:JSON.stringify(t),verticalKey:e.verticalKey,sessionTrackingEnabled:e.sessionTrackingEnabled},[4,this.httpService.get(this.filterEndpoint,r)];case 1:return n=o.sent(),(i=this.apiResponseValidator.validate(n))instanceof Error?[2,Promise.reject(i)]:[2,k(n)]}}))}))},e.prototype.serializeSearchParameterFields=function(e){return e.map((function(e){return{fieldId:e.fieldApiName,entityTypeId:e.entityType,shouldFetchEntities:e.fetchEntities}}))},e}(),M=(F=function(e,t){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}F(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Q=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.message=t,i.code=r,i.type=n,i}return M(t,e),t}(Error),Y=function(){function e(){}return e.prototype.validate=function(e){return[this.validateResponseProp,this.validateMetaProp,this.checkForApiErrors].map((function(t){return t(e)})).find((function(e){return e instanceof Q}))},e.prototype.validateResponseProp=function(e){if(!e.response)return new Q("Malformed Answers API response: missing response property.")},e.prototype.validateMetaProp=function(e){if(!e.meta)return new Q("Malformed Answers API response: missing meta property.")},e.prototype.checkForApiErrors=function(e){var t,r;if((null===(r=null===(t=e.meta)||void 0===t?void 0:t.errors)||void 0===r?void 0:r.length)>=1){var n=e.meta.errors[0];return new Q(n.message,n.code,n.type)}},e}();function J(e){var t=new _,r=new Y,n=new b(e,t,r),i=new A(e,t,r),o=new V(e,t,r);return new s(n,i,o)}function H(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){H(o,n,i,a,s,"next",e)}function s(e){H(o,n,i,a,s,"throw",e)}a(void 0)}))}}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}!function(e){e.Equals="$eq",e.NotEquals="!$eq",e.LessThan="$lt",e.LessThanOrEqualTo="$le",e.GreaterThan="$gt",e.GreaterThanOrEqualTo="$ge",e.Near="$near"}(N||(N={})),function(e){e.AND="$and",e.OR="$or"}(C||(C={})),function(e){e.Initialize="initialize",e.Suggest="suggest"}(L||(L={})),function(e){e.Field="FIELD",e.EntityDistance="ENTITY_DISTANCE",e.Relevance="RELEVANCE"}(q||(q={})),function(e){e.Ascending="ASC",e.Descending="DESC"}(D||(D={})),function(e){e.Ip="IP",e.Device="DEVICE",e.Unknown="UNKNOWN"}(K||(K={})),function(e){e.NearMe="NEAR_ME"}(U||(U={})),function(e){e.Suggest="SUGGEST",e.AutoCorrect="AUTOCORRECT",e.Combine="COMBINE"}(j||(j={}));var z={loading:!1,error:!1,core:void 0,hasSearched:!1,verticalKey:"",visibleSearchTerm:"",lastSearchedTerm:"",originalSearchTerm:"",verticalresults:void 0,results:[],entities:[],facets:[],displayableFacets:[],appliedQueryFilters:[],facetFilters:[],autocomplete:{querySuggestions:[],loading:!1,recentSearches:[],autocompleteOptions:[],selectedIndex:-1},debug:!1,locationBias:void 0,searchIntents:[]};function W(e){return e?e.map((function(e){return{fieldId:e.fieldId?e.fieldId:"emptyFieldId",displayName:e.fieldId?e.fieldId:"emptyDisplayName",options:e.options?(t=e.options,t.map((function(e){return{displayName:e.displayName,count:e.count,selected:e.selected,matcher:e.matcher,value:e.value}}))):[]};var t})):[]}var X,ee=function(e){return W(e).map((function(e){return[].concat(e.options.filter((function(e){return e.selected})).map((function(t){return{fieldId:e.fieldId,matcher:t.matcher,value:t.value}})))})).flat()},te=function(e,t,r){var n=W([].concat(e));n.forEach((function(e){e.fieldId===t&&e.options.forEach((function(e){e.displayName===r&&(e.selected=!e.selected)}))}));var i=n.filter((function(e){return e.options.some((function(e){return e.selected}))}));return i.forEach((function(e){e.options=e.options.filter((function(e){return e.selected}))})),i},re=function(e){var t=e.filter((function(e){return e.options.some((function(e){return e.selected}))}));return t.forEach((function(e){e.options=e.options.filter((function(e){return e.selected}))})),ne(t)},ne=function(e){var t=[];return e.forEach((function(e){t.push({fieldId:e.fieldId,options:e.options})})),t},ie=function(e,t){("SET_CONFIGURATION"===t.type&&t.config.debug||e.debug)&&console.log(t.type,t);var r=e.autocomplete,n=e.facetSorter;switch(t.type){case"PREPARE_FOR_SEARCH":return Z({},e,{loading:!0,error:!1,autocomplete:{loading:!1,autocompleteOptions:[],recentSearches:[],querySuggestions:[],selectedIndex:-1},lastSearchedTerm:t.searchTerm,visibleSearchTerm:t.searchTerm,originalSearchTerm:t.searchTerm});case"SET_CONFIGURATION":var i=t.config;return Z({},e,t.initialState,{core:J(i)},i,{debug:i.debug||!1});case"ON_SEARCH_TERM_CHANGE":return Z({},e,{visibleSearchTerm:t.searchTerm,originalSearchTerm:t.searchTerm});case"SET_ERROR":return e.debug&&console.log(t.error),Z({},e,{loading:!1,error:t.error});case"SET_VERTICAL_RESPONSE":var o=t.response,a=W(o.facets),s=ee(a),c=[].concat(e.facetFilters.filter((function(e){return-1===s.findIndex((function(t){return t.fieldId===e.fieldId&&t.value===e.value}))})),s),u=[];a.forEach((function(e){e.options.forEach((function(t){if(!0===t.selected){var r=u.findIndex((function(t){return t.fieldId===e.fieldId}));-1!==r?u[r].values.push(t.displayName):u.push({displayName:t.displayName,fieldId:e.fieldId,source:"FACET",values:[t.value.toString()]})}}))}));var l=n?n(a):a;return Z({},e,{loading:!1,autocomplete:{loading:!1,autocompleteOptions:[],recentSearches:[],querySuggestions:[],selectedIndex:-1},error:!1,verticalresults:o.verticalResults,hasSearched:!0,results:o.verticalResults.results,facets:l,displayableFacets:W(l),appliedFilters:u,facetFilters:c,locationBias:o.locationBias,searchIntents:o.searchIntents});case"SET_AUTOCOMPLETE":var p=t.querySuggestions,f=t.recentSearches;return Z({},e,{autocomplete:{loading:!1,querySuggestions:p,selectedIndex:-1,recentSearches:f,autocompleteOptions:[].concat(f.map((function(e){return{value:e.query,type:"RECENT"}})),p.filter((function(e){return!f.map((function(e){return e.query})).includes(e.value)})).map((function(e){return Z({},e,{type:"SUGGESTION"})}))).map((function(e){return Z({},e,{key:e.type+e.value})}))}});case"NEXT_AUTOCOMPLETE_OPTION":var d=Math.min(r.autocompleteOptions.length-1,r.selectedIndex+1);return Z({},e,{autocomplete:Z({},r,{autocompleteOptions:e.autocomplete.autocompleteOptions.map((function(e,t){return Z({},e,{highlighted:t===d})})),selectedIndex:d}),visibleSearchTerm:r.autocompleteOptions[d].value});case"PREVIOUS_AUTOCOMPLETE_OPTION":var h=Math.max(-1,r.selectedIndex-1),v=-1===h?e.originalSearchTerm:r.autocompleteOptions[h].value;return Z({},e,{autocomplete:Z({},r,{autocompleteOptions:e.autocomplete.autocompleteOptions.map((function(e,t){return Z({},e,{highlighted:t===h})})),selectedIndex:h}),visibleSearchTerm:v});case"UPDATE_LOCATION_BIAS":return Z({},e,{locationBias:t.locationBias});case"APPEND_RESULTS":return Z({},e,{results:[].concat(e.results,t.results)});case"UPDATE_SORT_BYS":return Z({},e,{sortBys:t.sortBys});case"UPDATE_DISPLAYABLE_FACETS":return Z({},e,{displayableFacets:t.displayableFacets});case"UPDATE_APPLIED_QUERY_FILTERS":return Z({},e,{appliedQueryFilters:t.appliedQueryFilters});case"UPDATE_FACETS":var y=t.facets;return Z({},e,{facetFilters:ee(y),facets:y});default:return e}},oe=n.createContext({state:z,dispatch:function(){return null}}),ae=function(e){var t=e.children,r=n.useReducer(ie,z);return i.createElement(oe.Provider,{value:{state:r[0],dispatch:r[1]}},t)},se=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=Object.create((t&&t.prototype instanceof p?t:p).prototype),o=new b(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function p(){}function f(){}function d(){}var h={};h[i]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(A([])));y&&y!==t&&r.call(y,i)&&(h=y);var m=d.prototype=p.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var n;this._invoke=function(i,o){function a(){return new t((function(n,a){!function n(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return f.prototype=m.constructor=d,d.constructor=f,f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(E.prototype),E.prototype[o]=function(){return this},e.AsyncIterator=E,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new E(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(X={exports:{}}),X.exports),ce=new a,ue=function(){var e=n.useContext(oe),t=e.state,r=e.dispatch,i=t.lastSearchedTerm,o=t.visibleSearchTerm,a=t.facets,s=t.autocomplete,c=t.sortBys,u=t.verticalKey,l=t.results,p=t.core,f=function(){var e=$(se.mark((function e(t,r){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===t&&(t=o),void 0===r&&(r=!0),ce.setRecentSearch(t),d(t,r?[]:a,c);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=$(se.mark((function e(t,n,i){var o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:"PREPARE_FOR_SEARCH",searchTerm:t}),r({type:"UPDATE_FACETS",facets:n||[]}),r({type:"UPDATE_DISPLAYABLE_FACETS",displayableFacets:W(n)}),e.prev=3,e.next=6,p.verticalSearch({query:t,context:{},verticalKey:u,retrieveFacets:!0,sortBys:i,facets:re(W(n))});case 6:r({type:"UPDATE_APPLIED_QUERY_FILTERS",appliedQueryFilters:(o=e.sent).verticalResults.appliedQueryFilters||[]}),r({type:"SET_VERTICAL_RESPONSE",response:o}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),r({type:"SET_ERROR",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),h=function(){var e=$(se.mark((function e(t,n,i){var o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:"PREPARE_FOR_SEARCH",searchTerm:t}),e.prev=1,o={latitude:n.latitude,longitude:n.longitude},e.next=5,p.verticalSearch({query:t,context:{},verticalKey:u,retrieveFacets:!0,sortBys:c,facets:re(i),location:o});case 5:r({type:"SET_VERTICAL_RESPONSE",response:e.sent}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),r({type:"SET_ERROR",error:e.t0});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),v=function(){var e=$(se.mark((function e(t){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=o),r({type:"ON_SEARCH_TERM_CHANGE",searchTerm:t}),e.next=4,p.verticalAutocomplete({input:t,verticalKey:u});case 4:r({type:"SET_AUTOCOMPLETE",querySuggestions:e.sent.results,recentSearches:ce.getRecentSearches(t)});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=$(se.mark((function e(t,n){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===n&&(n=!0),r({type:"UPDATE_SORT_BYS",sortBys:t}),n&&d(i,a,t);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return{state:t,actions:{runSearch:f,handleLocationBiasSearch:h,handleSearchTermChange:v,chooseAutocompleteOption:function(e){var t=s.autocompleteOptions[e];t?f(t.value):console.log("Index does not exist")},toggleFacet:function(){var e=$(se.mark((function e(n,o,a){var s,u;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===a&&(a=!0),s=te(t.facets,n,o),r({type:"UPDATE_FACETS",facets:ne(s)}),r({type:"UPDATE_DISPLAYABLE_FACETS",displayableFacets:s}),a&&(u=ne(s),d(i,u,c));case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),loadMore:function(){var e=$(se.mark((function e(t){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:"UPDATE_FACETS",facets:t||[]}),e.next=3,p.verticalSearch({query:i,context:{},verticalKey:u,retrieveFacets:!0,facets:re(W(t)),offset:l.length});case 3:r({type:"APPEND_RESULTS",results:e.sent.verticalResults.results});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),updateSortBys:y,setConfiguration:function(e,t){r({type:"SET_CONFIGURATION",config:e,initialState:t})},nextAutocompleteOption:function(){r({type:"NEXT_AUTOCOMPLETE_OPTION"})},prevAutocompleteOption:function(){r({type:"PREVIOUS_AUTOCOMPLETE_OPTION"})},clearSearch:function(){var e=W(a);r({type:"ON_SEARCH_TERM_CHANGE",searchTerm:""}),r({type:"UPDATE_FACETS",facets:e.map((function(e){return Z({},e,{options:e.options.map((function(e){return Z({},e,{selected:!1})}))})}))}),r({type:"UPDATE_SORT_BYS",sortBys:void 0}),d("",void 0,void 0)},simpleFilter:function(){var e=$(se.mark((function e(t,n){var o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===n&&(n="test"),(o=[]).push({fieldId:t,options:[{matcher:N.Equals,value:n}]}),r({type:"SIMPLE_FILTER_UPDATE",simpleFilters:o}),d(i,o,void 0);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}}},le=function(e){var t=e.config,r=e.children,a=t.runSearchOnLoad,s=void 0!==a&&a,c=ue(),u=c.state,l=c.actions,p=l.runSearch,f=l.setConfiguration,d=l.handleSearchTermChange,h=function(){var e=ue().state,t=o.useQueryParams({query:o.StringParam,filters:o.JsonParam,sortBys:o.JsonParam}),r=t[0],i=t[1],a=ee(e.facets);return n.useEffect((function(){i({query:e.lastSearchedTerm||void 0,filters:a.length>0?a:void 0,sortBys:e.sortBys||void 0})}),[e.lastSearchedTerm,a]),r}();return n.useEffect((function(){u.verticalKey||f(t,Z({},z,{lastSearchedTerm:h.query||"",originalSearchTerm:h.query||"",visibleSearchTerm:h.query||"",facetFilters:h.filters||[],sortBys:h.sortBys})),s&&u.verticalKey&&p(void 0,!1),u.verticalKey&&d()}),[s,u.verticalKey]),i.createElement(i.Fragment,null,r)};exports.AnswersContext=function(e){return i.createElement(o.QueryParamProvider,null,i.createElement(ae,null,i.createElement(le,Object.assign({},e))))},exports.provideCore=J,exports.useAnswers=ue;
//# sourceMappingURL=yext-answers-react.cjs.production.min.js.map
